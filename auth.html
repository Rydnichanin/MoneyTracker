<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–í—Ö–æ–¥ ‚Äî –£—á—ë—Ç –ö—É—Ä—å–µ—Ä–∞</title>
  <style>
    body { background: #000; color: #fff; font-family: -apple-system, sans-serif;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; height: 100vh; margin: 0; text-align: center; padding: 20px; }
    .btn { display: flex; align-items: center; gap: 12px; background: #fff;
      color: #000; border: none; border-radius: 14px; padding: 15px 28px;
      font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 24px; }
    .msg { color: #65d48b; margin-top: 20px; font-size: 14px; display: none; }
    .err { color: #ff6b6b; margin-top: 20px; font-size: 13px; display: none; }
  </style>
</head>
<body>
  <div style="font-size:52px;margin-bottom:16px;">üí∞</div>
  <h2 style="margin-bottom:8px;">–£—á—ë—Ç –ö—É—Ä—å–µ—Ä–∞ Pro</h2>
  <p style="color:#444;font-size:14px;" id="subtitle">–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google</p>

  <button class="btn" id="loginBtn" onclick="doLogin()">
    <svg width="20" height="20" viewBox="0 0 48 48">
      <path fill="#4285F4" d="M44.5 20H24v8.5h11.8C34.7 33.9 29.8 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 5.1 29.6 3 24 3 12.4 3 3 12.4 3 24s9.4 21 21 21c10.5 0 20-7.6 20-21 0-1.4-.1-2.7-.5-4z"/>
    </svg>
    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
  </button>

  <div class="msg" id="msg"></div>
  <div class="err" id="err"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const app = initializeApp({
      apiKey: "AIzaSyBYvSsrzjgkrBwhaBAt0KlCGrAtzgOPYx8",
      authDomain: "moneytracker-5335b.firebaseapp.com",
      projectId: "moneytracker-5335b",
      storageBucket: "moneytracker-5335b.firebasestorage.app",
      messagingSenderId: "440589448883",
      appId: "1:440589448883:web:5ad507b270fa414731a2c6"
    });

    const auth = getAuth(app);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("subtitle").textContent = "–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ö–æ–¥...";

    getRedirectResult(auth).then(result => {
      if (result && result.user) {
        // –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω ‚Äî –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
        const credential = GoogleAuthProvider.credentialFromResult(result);
        const idToken = credential.idToken;
        const name = encodeURIComponent(result.user.displayName || '');
        const email = encodeURIComponent(result.user.email || '');

        document.getElementById("msg").textContent = "‚úÖ –í—Ö–æ–¥–∏–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...";
        document.getElementById("msg").style.display = "block";

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ deep link
        setTimeout(() => {
          window.location.href = "moneytracker://auth?idToken=" + encodeURIComponent(idToken) + "&name=" + name + "&email=" + email;
        }, 500);

      } else {
        // –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        document.getElementById("loginBtn").style.display = "flex";
        document.getElementById("subtitle").textContent = "–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google";
      }
    }).catch(err => {
      document.getElementById("loginBtn").style.display = "flex";
      document.getElementById("subtitle").textContent = "–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google";
      if (err.code !== 'auth/no-current-user') {
        document.getElementById("err").textContent = "–û—à–∏–±–∫–∞: " + err.message;
        document.getElementById("err").style.display = "block";
      }
    });

    window.doLogin = () => {
      document.getElementById("loginBtn").style.display = "none";
      document.getElementById("subtitle").textContent = "–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ Google...";
      const provider = new GoogleAuthProvider();
      signInWithRedirect(auth, provider);
    };
  </script>
</body>
</html>
