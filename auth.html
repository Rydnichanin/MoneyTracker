<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–í—Ö–æ–¥ ‚Äî –£—á—ë—Ç –ö—É—Ä—å–µ—Ä–∞</title>
  <style>
    body { background: #000; color: #fff; font-family: -apple-system, sans-serif;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; height: 100vh; margin: 0; text-align: center; padding: 20px; }
    .btn { display: flex; align-items: center; gap: 12px; background: #fff;
      color: #000; border: none; border-radius: 14px; padding: 15px 28px;
      font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 24px; }
    .msg { color: #65d48b; margin-top: 20px; font-size: 15px; display: none; }
    .err { color: #ff6b6b; margin-top: 20px; font-size: 14px; display: none; }
  </style>
</head>
<body>
  <div style="font-size:52px;margin-bottom:16px;">üí∞</div>
  <h2 style="margin-bottom:8px;">–£—á—ë—Ç –ö—É—Ä—å–µ—Ä–∞ Pro</h2>
  <p style="color:#444;font-size:14px;">–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google</p>

  <button class="btn" onclick="doLogin()">
    <svg width="20" height="20" viewBox="0 0 48 48">
      <path fill="#4285F4" d="M44.5 20H24v8.5h11.8C34.7 33.9 29.8 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 5.1 29.6 3 24 3 12.4 3 3 12.4 3 24s9.4 21 21 21c10.5 0 20-7.6 20-21 0-1.4-.1-2.7-.5-4z"/>
    </svg>
    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
  </button>

  <div class="msg" id="msg">‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
  <div class="err" id="err"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const app = initializeApp({
      apiKey: "AIzaSyBYvSsrzjgkrBwhaBAt0KlCGrAtzgOPYx8",
      authDomain: "moneytracker-5335b.firebaseapp.com",
      projectId: "moneytracker-5335b",
      storageBucket: "moneytracker-5335b.firebasestorage.app",
      messagingSenderId: "440589448883",
      appId: "1:440589448883:web:5ad507b270fa414731a2c6"
    });

    const auth = getAuth(app);

    window.doLogin = async () => {
      try {
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        // –ü–æ–ª—É—á–∞–µ–º ID —Ç–æ–∫–µ–Ω
        const idToken = await user.getIdToken();

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage —á—Ç–æ–±—ã –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–≥–ª–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å
        localStorage.setItem('mt_auth_token', idToken);
        localStorage.setItem('mt_auth_uid', user.uid);
        localStorage.setItem('mt_auth_email', user.email);
        localStorage.setItem('mt_auth_name', user.displayName || user.email);

        document.getElementById("msg").style.display = "block";
        document.querySelector(".btn").style.display = "none";

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          window.close();
          // –ï—Å–ª–∏ window.close –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç
          window.location.href = "moneytracker://auth?token=" + encodeURIComponent(idToken);
        }, 1500);

      } catch(e) {
        document.getElementById("err").textContent = "–û—à–∏–±–∫–∞: " + e.message;
        document.getElementById("err").style.display = "block";
      }
    };
  </script>
</body>
</html>
